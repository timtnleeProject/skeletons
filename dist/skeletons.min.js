window.Skeletons=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var o=function(t){t.prototype.validate=function(e,n={}){const o=Object.assign({root:this,isbranch:!1},this.default);return n=t.setDefault(n,o),Object.assign(this,n),this.data=e,this.valid=!0,Object.defineProperty(this,"store",{value:{},configurable:!0,enumerable:!0,writable:!1}),this.warnings=[],this.lookup([]),this},t.prototype.subValidate=function(t,e){return this.validate(t,{isbranch:!0,root:e})},t.prototype.lookup=function(e=[]){let{schema_deep:n,data_deep:o}=this.getDepth(e);if(n instanceof t.Types){const t=n;return void this[t.fname](t.opt,e)}if("function"==typeof n){const i=typeof n();if(i!==typeof o){let n=t.typeof(o);this.warn(e,`expect [${i}] but got [${n}]`,0)}return}const i=t.typeof(n);if("array"===i){const i=t.typeof(o);if("array"!==i)return void this.warn(e,`expect [array] but got [${i}]`,0);if(n.forEach((t,n)=>{this.lookup([...e,n])}),n.length<o.length){let t=n.length;for(;t<o.length;)this.warn([...e,t],`index [${t}] not defined in schema`,4),t++}return}if("object"!==i)return void this.warn(e,"is not a valid schema and will be ignored, please fixed it.",99);const r=t.typeof(o);if("object"!=r)return this.warn(e,`expect object, got ${r}`,1);let a={...o};for(let t in n)delete a[t],this.lookup([...e,t]);if(!this.rule.extraKey)for(let t in a)this.warn(e,`property '${t}' not defined in schema`,5)},t.prototype.getDepth=function(t){let e=this.schema,n=this.data;return t.forEach(t=>{e=e[t],n=n[t]}),{schema_deep:e,data_deep:n}},t.prototype.warn=function(e,n,o){!0===this.valid&&(this.valid=!1);let i="",r=o>=10?this.schemaName:this.dataName;switch(o){case 0:i="[Unexpected Type]";break;case 2:i="[Value invalid]";break;case 4:i="[Unknown index]";break;case 5:i="[Unknown Property]";break;case 6:i="[keyValidator failed]";break;case 7:i="[Types Not Matched]";break;case 8:i="[Class Not Matched]";break;case 99:i="[Wrong Schema]"}const a=`Skeletons Warn: ${i} at ${r}${t.getKeyStr(e)}: ${n}`;if(this.warnings.push(new t.Warnings({code:o,log:n,type:i,depth:e})),!this.isbranch){if(this.throw||o>=10)throw a;return this.console?console.log(a):void 0}},t.prototype.useOriginWarn=function({warnings:t,originDepth:e,schemaName:n}){t.forEach(t=>{const o=this.schemaName;this.schemaName=`${o}: ${n}`;let i=t.code>10?[]:[...e,...t.depth];t.code>10&&(this.isbranch=!1),this.warn(i,t.log,t.code),this.schemaName=o})}};function i(t,e={}){this.schema=t,this.default={dataName:"data",schemaName:"schema",console:!0,throw:!1,rule:{extraKey:!1}},this.default=i.setDefault(e,this.default)}(function(t){t._version_="0.0.12",t.String=function(e){return new t.Types(e,"StringFn",{})},t.Array=function(e){const n={item:null,array:void 0};return new t.Types(e,"ArrayFn",n)},t.Boolean=function(e){return new t.Types(e,"BooleanFn",{})},t.Number=function(e){return new t.Types(e,"NumberFn",{allowNaN:!0})},t.Object=function(e){return new t.Types(e,"ObjectFn",{class:null,extraKey:!1,object:{}})},t.MapObject=function(e){return new t.Types(e,"MapObjectFn",{keyValidator:null,item:null})},t.Function=function(e){return new t.Types(e,"FunctionFn",{})},t.Symbol=function(e){return new t.Types(e,"SymbolFn",{})},t.Null=function(e){return new t.Types(e,"NullFn",{})},t.Any=function(e){return new t.Types(e,"AnyFn",{exclude:null,include:null})},t.Types=function(e={},n,o){const i={required:!0,default:void 0,validator:null},r=Object.assign(i,o);this.opt=t.setDefault(e,r),this.fname=n},t.Warnings=function(e){new t({code:Number,log:String,type:String,depth:t.Array()}).validate(e,{throw:!0});for(let t in e)this[t]=e[t]},t.typeof=function(t){return null===t?"null":Array.isArray(t)?"array":typeof t},t.getKeyStr=function(t){let e="";return t.forEach(t=>{e+=`[${"string"==typeof t?`'${t}'`:t}]`}),e||" "},t.setDefault=function(e,n){if(!e)return n;if("object"!==t.typeof(e))throw"Skeletons.setDefault(data, options), options must be object";for(let t in n)void 0===e[t]&&(e[t]=n[t]);return e},t.expectType=function(e){return e instanceof t.Types?e.name.toLowerCase():"function"==typeof e?t.typeof(e()):t.typeof(e)}})(i),o(i),function(t){t.prototype.SOP=function(e,n,o,i){let{data_deep:r}=this.getDepth(n);if(!(!1===e.required&&void 0===r||void 0!==e.default&&r===e.default)){if(i(r)){if(e.validator){if("function"!=typeof e.validator)return this.warn(n,"options.validator must be a function",99);if(!0!==e.validator(r,this.root.data,this.root.store))return this.warn(n,"validation failed",2)}return 200}{const e=t.typeof(r);this.warn(n,`expect [${o}] but got [${e}]`,0)}}},t.prototype.ArrayFn=function(e,n){if(200!=this.SOP(e,n,"array",t=>Array.isArray(t)))return;const{data_deep:o}=this.getDepth(n);if(e.item){const i=new t(e.item);o.forEach((t,e)=>{i.subValidate(t,this.root),i.valid||this.useOriginWarn({warnings:i.warnings,originDepth:[...n,e],schemaName:"Skeletons.Array({ item }) options.item"})})}if(void 0!==e.array){const i=e.array;if("array"!==t.typeof(i))return this.warn(n,"Skeletons.Array({ array }) options.array must be an array iteral schema []",99);const r=new t(i);r.subValidate(o,this.root),r.valid||this.useOriginWarn({warnings:r.warnings,originDepth:[...n],schemaName:"Skeletons.Array({ array }) options.array"})}},t.prototype.ObjectFn=function(e,n){if(200!=this.SOP(e,n,"object",e=>"object"===t.typeof(e)))return;const{data_deep:o}=this.getDepth(n);if(e.class){if("function"!=typeof e.class)return this.warn(n,"Skeletons.Object({ class }) options.class is not a function/class",99);o instanceof e.class||this.warn(n,`object expect instanceof [${e.class.name}] but got instanceof [${Object.getPrototypeOf(o).constructor.name}]`,8)}if(e.object){if("object"!==t.typeof(e.object))return this.warn(n,"Skeletons.Object({ object }) options.object must be an object {}",99);if(e.object instanceof t.Types)return this.warn(n,"Skeletons.Object({ object }) options.object can only use literal object schema {}",99);const i=new t(e.object,{rule:{extraKey:e.extraKey}});i.subValidate(o,this.root),i.valid||this.useOriginWarn({warnings:i.warnings,originDepth:n,schemaName:"Skeletons.Object({ object }) options.object"})}},t.prototype.MapObjectFn=function(e,n){if(200!=this.SOP(e,n,"object",e=>"object"===t.typeof(e)))return;const{data_deep:o}=this.getDepth(n),i={keyValidator:!1,validateItem:!1},r=t=>{i.keyValidator&&!0!==e.keyValidator(t,this.root.data,this.root.store)&&this.warn(n,`keyValidator failed at key ${t}`,6)},a=(t,e,o)=>{i.validateItem&&(o.subValidate(e[t],this.root),o.valid||this.useOriginWarn({warnings:o.warnings,originDepth:[...n,t],schemaName:"Skeletons.MapObject({ item }) options.item"}))};if(e.keyValidator){if("function"!=typeof e.keyValidator)return this.warn(n,"Skeletons.MapObject({ keyValidator }) options.keyValidator must be function",99);i.keyValidator=!0}if(e.item&&(i.validateItem=!0),!i.validateItem&&!i.keyValidator)return;const s=new t(e.item);for(let t in o)r(t),a(t,o,s)},t.prototype.FunctionFn=function(e,n){this.SOP(e,n,"function",e=>"function"===t.typeof(e))},t.prototype.NullFn=function(e,n){this.SOP(e,n,"null",e=>"null"===t.typeof(e))},t.prototype.StringFn=function(t,e){this.SOP(t,e,"string",t=>"string"==typeof t)},t.prototype.NumberFn=function(t,e){if(200!=this.SOP(t,e,"number",t=>"number"==typeof t))return;const{data_deep:n}=this.getDepth(e);!1===t.allowNaN&&isNaN(n)&&this.warn(e,"Skeletons.Number({ allowNaN:false }), NaN value not allowed",0)},t.prototype.BooleanFn=function(t,e){this.SOP(t,e,"boolean",t=>"boolean"==typeof t)},t.prototype.SymbolFn=function(t,e){this.SOP(t,e,"symbol",t=>"symbol"==typeof t)},t.prototype.AnyFn=function(e,n){if(this.SOP(e,n,"any",()=>!0),e.include&&e.exclude)return this.warn(n,"Skeletons.Any({ include, exclude }): you defined both include and exclude, which can only be one of them.",99);if(e.include){if(!Array.isArray(e.include))return this.warn(n,"Skeletons.Any({ include }): include must be array",99);const{data_deep:o}=this.getDepth(n);let i=!1;for(let n=0;n<e.include.length;n++){let r=e.include[n],a=new t(r);if(a.subValidate(o,this.root),a.valid){i=!0;break}}i||this.warn(n,"validation fail at Skeletons.Any({ include }): ",7)}if(e.exclude){if(!Array.isArray(e.exclude))return this.warn(n,"Skeletons.Any({ exclude }): exclude must be array",99);const{data_deep:o}=this.getDepth(n);let i=!0;for(let n=0;n<e.exclude.length;n++){let r=e.exclude[n],a=new t(r);if(a.subValidate(o,this.root),a.valid){i=!1;break}}i||this.warn(n,"validation fail at Skeletons.Any({ exclude })",7)}}}(i);e.default=i}]);